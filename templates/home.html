{% extends "base.html" %}
{% block content %}

<div class="homeContainer">

    <!-- LEFT COLUMN: search + restaurant list -->
    <div class="left-column">

        <!-- Search Bar -->
        <div class="search-box">
            <form action="/restaurants/search" method="get" class="search-form">
                <input 
                    type="text" 
                    name="query" 
                    placeholder="Search restaurants or cuisine..."
                    value="{{ query if query is defined else '' }}"
                />
                <button type="submit">Search</button>
            </form>
        </div>

        <!-- Restaurant List -->
        <div class="restaurant-list">
            {% if restaurants and restaurants|length > 0 %}
                {% for r in restaurants %}
                <article class="restaurant-card">

                    <a href="{{ url_for('restaurants.get_restaurant', id=r.id) }}">
                        <img 
                            src="{{ r.image_url or url_for('static', filename='images/restraunt1.jpg') }}" 
                            alt="{{ r.name }}" 
                            class="card-img"
                        />
                    </a>

                    <div class="card-body restaurant-info">
                        <h3>
                            <a href="{{ url_for('restaurants.get_restaurant', id=r.id) }}">
                                {{ r.name }}
                            </a>
                        </h3>
                        <p class="muted">{{ r.cuisine }} â€” {{ r.halal_status }}</p>
                        <p>{{ r.description }}</p>
                    </div>

                </article>
                {% endfor %}

            {% elif query %}
                <p>No restaurants matched "{{ query }}".</p>

            {% else %}
                <p>Search for halal restaurants in Philadelphia.</p>
            {% endif %}
        </div>

    </div>

    <!-- RIGHT COLUMN: Map -->
    <div class="right-column">
        <div id="home-map"></div>
    </div>

</div>


<!-- Leaflet CSS + JS -->
<link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet/dist/leaflet.css" 
/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Pass Restaurants to JS -->
<script>
    const homeRestaurantsData = {{ restaurants | tojson | safe }};
</script>

<!-- Map JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    if (!homeRestaurantsData || homeRestaurantsData.length === 0) return;

    const map = L.map("home-map").setView(
        [homeRestaurantsData[0].latitude, homeRestaurantsData[0].longitude],
        13
    );

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    homeRestaurantsData.forEach(r => {
        if (r.latitude && r.longitude) {
            const marker = L.marker([r.latitude, r.longitude]).addTo(map);

            marker.bindPopup(`
                <strong>${r.name}</strong><br/>
                ${r.address}<br/>
                <a href="/restaurants/${r.id}">View details</a>
            `);
        }
    });
});
</script>

{% endblock %}