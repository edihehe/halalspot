{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/fyp.css') }}">

<div class="fyp-container">
    <div class="fyp-feed" id="fypFeed">
        {% if contents %}
            {% for content in contents %}
            <div class="fyp-post" data-content-id="{{ content.id }}">
                <!-- Post Image/Video -->
                <div class="post-media">
                    <img src="{{ content.image_url or '/static/images/rest_images.jpg' }}" alt="{{ content.title }}" />
                    <div class="post-overlay"></div>
                </div>

                <!-- Right Sidebar - Actions -->
                <div class="post-actions">
                    <!-- Profile/Avatar -->
                    <div class="action-profile">
                        {% if content.restaurant %}
                            <div class="profile-avatar">
                                <img src="{{ content.restaurant.image_url or '/static/images/logo.png' }}" alt="{{ content.restaurant.name }}" />
                            </div>
                        {% elif content.creator_name %}
                            <div class="profile-avatar creator">
                                <span>{{ content.creator_name[0]|upper }}</span>
                            </div>
                        {% else %}
                            <div class="profile-avatar">
                                <img src="/static/images/logo.png" alt="HalalSpot" />
                            </div>
                        {% endif %}
                    </div>

                    <!-- Like Button -->
                    <button class="action-btn like-btn" data-content-id="{{ content.id }}" data-liked="false">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                        <span class="action-count" id="likes-{{ content.id }}">{{ content.likes_count }}</span>
                    </button>

                    <!-- Comment Button -->
                    <button class="action-btn comment-btn" data-content-id="{{ content.id }}">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <span class="action-count" id="comments-{{ content.id }}">{{ content.comments_count }}</span>
                    </button>

                    <!-- Share Button -->
                    <button class="action-btn share-btn" data-content-id="{{ content.id }}">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                            <polyline points="16 6 12 2 8 6"></polyline>
                            <line x1="12" y1="2" x2="12" y2="15"></line>
                        </svg>
                        <span class="action-count" id="shares-{{ content.id }}">{{ content.shares_count }}</span>
                    </button>

                    <!-- Save Button -->
                    <button class="action-btn save-btn" data-content-id="{{ content.id }}" data-saved="false">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <span class="action-count" id="saves-{{ content.id }}">{{ content.saves_count }}</span>
                    </button>

                    <!-- Order Now Button (Most Important) -->
                    {% if content.restaurant_id or content.order_url %}
                    <button class="action-btn order-btn" data-content-id="{{ content.id }}" data-restaurant-id="{{ content.restaurant_id or '' }}" data-order-url="{{ content.order_url or '' }}">
                        <svg class="action-icon order-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="action-label">Order</span>
                    </button>
                    {% endif %}
                </div>

                <!-- Bottom Info Section -->
                <div class="post-info">
                    <div class="post-header">
                        {% if content.restaurant %}
                            <h3 class="post-title">{{ content.restaurant.name }}</h3>
                            {% if content.is_sponsored %}
                                <span class="sponsored-badge">Sponsored</span>
                            {% endif %}
                        {% elif content.creator_name %}
                            <h3 class="post-title">{{ content.creator_name }}</h3>
                            <span class="sponsored-badge">Creator</span>
                        {% else %}
                            <h3 class="post-title">HalalSpot</h3>
                        {% endif %}
                    </div>
                    
                    <p class="post-description">
                        <strong>{{ content.title }}</strong><br/>
                        {{ content.description }}
                    </p>

                    <!-- Comments Section (Collapsible) -->
                    <div class="comments-section" id="comments-section-{{ content.id }}" style="display: none;">
                        <div class="comments-list" id="comments-list-{{ content.id }}"></div>
                        <div class="comment-input-container">
                            <input type="text" class="comment-input" id="comment-input-{{ content.id }}" placeholder="Add a comment..." />
                            <button class="comment-submit" data-content-id="{{ content.id }}">Post</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-content">
                <p>No content available yet. Check back soon!</p>
            </div>
        {% endif %}
    </div>
</div>

<script src="{{ url_for('static', filename='js/fyp.js') }}"></script>
<script>
    // Pass content data to JavaScript
    const fypContentData = {{ contents | tojson | safe }};
</script>

{% endblock %}

